<?xml version="1.0"?>

<!--
    File: unina_multi.launch
    Description: Example launch file to run a two-robot system (Master and Slave)
                 using a shared /map topic for autonomous navigation.
                 
    Notes:
    - This is only a basic example to demonstrate multi-agent launch.
    - The two robots are namespaced under /robot1 and /robot2.
    - The Master (robot1) builds or loads the map and publishes it.
    - The Slave (robot2) subscribes to the existing map and navigates.
    - In a real deployment, it is recommended to split the launch files into two separate
      ones (one per robot), possibly running on different machines (decentralized).
    - Proper ROS Master URI and Hostname settings are required across robots.

    Authors: Armando Nicolella, Pierangelo Malfi
    Institution: University of Naples Federico II

    Last updated: April 26, 2025
-->

<launch>

    <!-- ================= MASTER ROBOT ================= -->
    <group ns="robot1">

        <!-- Launch robot base -->
        <include file="$(find scout_bringup)/launch/scout_mini_robot_base.launch" />

        <!-- Launch Velodyne driver -->
        <include file="$(find velodyne_pointcloud)/launch/VLP16_points.launch" />

        <!-- PointCloud to LaserScan node -->
        <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pc2ls_node_master" output="screen">
            <remap from="cloud_in" to="/robot1/velodyne_points" />
        </node>

        <!-- Direct Lidar Odometry (DLO) -->
        <include file="$(find direct_lidar_odometry)/launch/dlo.launch" />

        <!-- Mapping (Gmapping) - only for the Master -->
        <include file="$(find gmapping)/launch/gmapping.launch" />

        <!-- Autonomous Navigation (move_base) -->
        <include file="$(find move_base)/launch/move_base.launch" />

    </group>

    <!-- ================= SLAVE ROBOT ================= -->
    <group ns="robot2">

        <!-- Launch robot base -->
        <include file="$(find scout_bringup)/launch/scout_mini_robot_base.launch" />

        <!-- Launch Velodyne driver -->
        <include file="$(find velodyne_pointcloud)/launch/VLP16_points.launch" />

        <!-- PointCloud to LaserScan node -->
        <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pc2ls_node_slave" output="screen">
            <remap from="cloud_in" to="/robot2/velodyne_points" />
        </node>

        <!-- Direct Lidar Odometry (DLO) -->
        <include file="$(find direct_lidar_odometry)/launch/dlo.launch" />

        <!-- No Gmapping for Slave -->

        <!-- Autonomous Navigation (move_base) -->
        <include file="$(find move_base)/launch/move_base.launch" />

    </group>

</launch>
